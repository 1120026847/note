<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Notes</title>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons"></script>
  <!-- CloudBase Web SDK (v2) -->
  <script src="https://static.cloudbase.net/cloudbase-js-sdk/2.17.3/cloudbase.full.js"></script>
  <!-- COS JS SDK v5 -->
  <script src="https://cdn.jsdelivr.net/npm/cos-js-sdk-v5/dist/cos-js-sdk-v5.min.js"></script>
  <!-- Quill -->
  <link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <!-- html2canvas + jsPDF（导出为 PDF 用） -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    /* 左侧文件树滚动 */
    #file-tree { scrollbar-width: thin }
    /* 隐藏默认 file input */
    input[type="file"] { display: none; }
    .menu-btn { @apply px-3 py-1 rounded border text-sm hover:bg-gray-50; }
  </style>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- 顶部全局 Toast -->
  <div id="toast" class="fixed right-4 top-4 z-50 hidden px-4 py-2 rounded bg-gray-900 text-white shadow"></div>

  <!-- 认证视图 -->
  <section id="auth-view" class="min-h-screen grid place-items-center">
    <div class="w-full max-w-md bg-white rounded-xl shadow p-6">
      <div class="flex gap-4 mb-6">
        <button id="tab-login"    class="menu-btn border-gray-800 bg-gray-900 text-white">登录</button>
        <button id="tab-register" class="menu-btn">注册</button>
      </div>

      <!-- 登录 -->
      <form id="login-form" class="space-y-4">
        <div>
          <label class="text-sm">邮箱</label>
          <input id="login-email" class="w-full border rounded px-3 py-2" type="email" required />
        </div>
        <div>
          <label class="text-sm">密码</label>
          <input id="login-password" class="w-full border rounded px-3 py-2" type="password" required />
        </div>
        <button class="w-full bg-gray-900 text-white rounded py-2">登录</button>
      </form>

      <!-- 注册 -->
      <form id="register-form" class="space-y-4 hidden">
        <div>
          <label class="text-sm">邮箱</label>
          <input id="register-email" class="w-full border rounded px-3 py-2" type="email" required />
        </div>
        <div>
          <label class="text-sm">密码</label>
          <input id="register-password" class="w-full border rounded px-3 py-2" type="password" required />
        </div>
        <button class="w-full bg-gray-900 text-white rounded py-2">注册</button>
        <p class="text-xs text-gray-500">注册后需留意邮箱进行验证（CloudBase 支持邮箱验证流程）。</p>
      </form>
    </div>
  </section>

  <!-- 主应用视图 -->
  <section id="main-app-view" class="hidden">
    <div class="h-screen grid grid-cols-[300px,1fr]">
      <!-- 侧边栏 -->
      <aside class="bg-white border-r flex flex-col">
        <!-- 用户区 -->
        <div class="p-4 border-b">
          <div class="flex items-center gap-3">
            <div id="user-avatar" class="w-10 h-10 grid place-items-center rounded-full bg-gray-900 text-white font-bold">U</div>
            <div class="flex-1">
              <div id="user-email" class="font-medium"></div>
              <button id="btn-logout" class="text-xs text-gray-500 hover:text-gray-900">退出登录</button>
            </div>
          </div>
          <div class="mt-4 grid grid-cols-2 gap-2">
            <button id="btn-new-folder" class="menu-btn">新建文件夹</button>
            <button id="btn-new-article" class="menu-btn">新建文章</button>
          </div>
        </div>

        <!-- 文件树 -->
        <div id="file-tree" class="flex-1 overflow-y-auto p-2 space-y-3"></div>

        <!-- 数据管理 -->
        <div class="border-t p-3">
          <details>
            <summary class="cursor-pointer text-sm text-gray-700">数据管理</summary>
            <div class="mt-3 space-y-2">
              <label for="pdf-input" class="menu-btn block text-center cursor-pointer">导入 PDF</label>
              <input id="pdf-input" type="file" accept="application/pdf" />
              <label for="backup-input" class="menu-btn block text-center cursor-pointer">导入备份</label>
              <input id="backup-input" type="file" accept="application/json" />
              <button id="btn-export" class="menu-btn w-full">导出备份</button>
            </div>
          </details>
        </div>
      </aside>

      <!-- 主内容区 -->
      <main class="flex flex-col">
        <!-- 头部 -->
        <header class="bg-white border-b px-4 py-2 flex items-center gap-3">
          <button id="btn-toggle-sidebar" class="md:hidden"><i data-feather="menu"></i></button>
          <div id="header-title" class="font-semibold flex-1 truncate">欢迎</div>

          <!-- PDF 翻页控件（PDF 模式下显示）-->
          <div id="pdf-controls" class="hidden items-center gap-2">
            <button id="pdf-prev" class="menu-btn">上一页</button>
            <div id="pdf-pageinfo" class="text-sm text-gray-600">- / -</div>
            <button id="pdf-next" class="menu-btn">下一页</button>
          </div>

          <div class="flex items-center gap-2">
            <button id="btn-edit"   class="menu-btn hidden">编辑</button>
            <button id="btn-save"   class="menu-btn hidden">保存</button>
            <button id="btn-export-article" class="menu-btn hidden">导出</button>
            <button id="btn-delete" class="menu-btn hidden">删除</button>
          </div>
        </header>

        <!-- 内容视图 -->
        <div id="welcome-view" class="flex-1 grid place-items-center">
          <div class="text-center text-gray-600">
            <div class="text-xl mb-2">欢迎使用 My Notes</div>
            <p>从左侧新建或选择一篇文章开始吧。</p>
          </div>
        </div>

        <div id="article-view" class="hidden flex-1">
          <!-- 富文本编辑器 -->
          <div id="richtext-editor-view" class="w-full h-full">
            <div id="toolbar" class="border-b">
              <span class="ql-formats">
                <select class="ql-header">
                  <option selected></option>
                  <option value="1"></option>
                  <option value="2"></option>
                </select>
              </span>
              <span class="ql-formats">
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <button class="ql-underline"></button>
              </span>
              <span class="ql-formats">
                <button class="ql-list" value="ordered"></button>
                <button class="ql-list" value="bullet"></button>
              </span>
              <span class="ql-formats">
                <button id="btn-insert-image"><i data-feather="image"></i></button>
              </span>
            </div>
            <div id="editor" class="h-[calc(100vh-160px)]"></div>
            <input id="image-input" type="file" accept="image/*" />
          </div>

          <!-- PDF 阅读器 -->
          <div id="pdf-reader-view" class="w-full h-full hidden overflow-auto p-4 space-y-4"></div>
        </div>
      </main>
    </div>
  </section>

  <script src="./app.js"></script>
  <script>feather.replace()</script>
</body>
</html>
